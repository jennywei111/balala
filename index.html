<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è±ç”ŸèŒ¶é¤¨ï¼šåƒè²¨å ±åæŒ‘æˆ°</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        :root { --main-color: #8B4513; --bg-color: #FDF5E6; }
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: var(--bg-color); margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        #game-container { width: 100%; max-width: 400px; padding: 20px; text-align: center; box-sizing: border-box; }
        .board { display: grid; grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(4, 1fr); gap: 5px; margin: 20px 0; background: #ddd; padding: 5px; border-radius: 10px; position: relative; }
        .cell { aspect-ratio: 1; background: white; border-radius: 5px; display: flex; align-items: center; justify-content: center; font-size: 20px; position: relative; }
        .center { grid-column: 2 / 4; grid-row: 2 / 4; background: #FFDAB9; font-weight: bold; font-size: 14px; display: flex; flex-direction: column; justify-content: center; border-radius: 5px; }
        #player { width: 35px; height: 35px; border-radius: 50%; position: absolute; transition: all 0.3s ease; z-index: 10; border: 2px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.3); left: 0; top: 0; }
        .btn { background: #E67E22; color: white; border: none; padding: 12px 25px; border-radius: 25px; font-size: 18px; cursor: pointer; box-shadow: 0 4px #D35400; }
        .btn:active { transform: translateY(2px); box-shadow: 0 2px #D35400; }
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 100; display: flex; align-items: center; justify-content: center; }
        .modal { background: white; padding: 25px; border-radius: 20px; width: 85%; max-width: 320px; text-align: center; }
        .ticket { border: 2px dashed #8B4513; padding: 15px; background: #FFF9E3; }
        .glass-heart { color: #e74c3c; font-size: 14px; font-weight: bold; margin: 15px 0; line-height: 1.5; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div id="game-container">
    <h2>ğŸµ è±ç”ŸèŒ¶é¤¨æŒ‘æˆ°</h2>
    <div id="stat">ç¾é£Ÿ: <span id="food-count">0</span> / 4 | åœˆæ•¸: <span id="lap-count">1</span> / 5</div>
    
    <div class="board" id="board">
        <img id="player" src="https://cdn-icons-png.flaticon.com/512/147/147144.png" alt="player">
        <div class="center">è±ç”ŸèŒ¶é¤¨<br>3/8 12:00</div>
    </div>

    <button class="btn" id="dice-btn">ğŸ² æ“²éª°å­</button>
    <div id="msg" style="margin-top:15px; min-height: 1.5em; color: #8B4513; font-weight: bold;">å§æ‹‰æ‹‰ï¼šåŠ æ²¹å–”ï¼</div>
</div>

<div id="overlay">
    <div class="modal" id="modal-content">
        <h3>ğŸ“¢ ç‰¹é£ä»»å‹™å ±å‘Š</h3>
        <p>å§æ‹‰æ‹‰å°æ’­ï¼š3/8 èšé¤ä½å­è¨‚å¥½äº†ï¼è«‹é›†é½Š 4 å€‹ç¾é£Ÿæˆ–ç¹å®Œ 5 åœˆå®Œæˆå ±åã€‚</p>
        <p style="color:red; font-weight:bold;">âš ï¸ æ¯äººéœ€äº¤ $100 è¨‚é‡‘ï¼Œä¸»è¾¦æ–¹ç»ç’ƒå¿ƒå®³æ€•è¢«æ”¾é´¿å­...</p>
        <button class="btn" id="start-btn">äº†è§£ï¼Œé–‹å§‹æ”¶é›†ï¼</button>
    </div>
</div>

<script>
    const liffId = "2009192757-ZZX0pw1b";
    let currentPos = 0;
    let foodCollected = new Set();
    let laps = 1;
    const boardSize = 12;
    const foodCells = { 2: "ğŸ±", 5: "ğŸ§‹", 8: "ğŸ¥Ÿ", 11: "ğŸ—" };

    // åˆå§‹åŒ–ç¶²é 
    window.onload = function() {
        // ç”Ÿæˆæ ¼å­
        const boardNode = document.getElementById('board');
        for(let i=0; i<12; i++) {
            let div = document.createElement('div');
            div.className = 'cell';
            div.id = 'cell-' + i;
            div.innerText = foodCells[i] || "âšª";
            boardNode.appendChild(div);
        }
        
        // ç¶å®šæŒ‰éˆ•
        document.getElementById('start-btn').onclick = function() {
            document.getElementById('overlay').classList.add('hidden');
        };

        document.getElementById('dice-btn').onclick = rollDice;

        // åˆå§‹åŒ– LIFF
        liff.init({ liffId }).then(() => {
            if (!liff.isLoggedIn()) { liff.login(); }
            liff.getProfile().then(p => { 
                document.getElementById('player').src = p.pictureUrl; 
            });
        });

        setTimeout(updatePlayerPos, 500);
    };

    function updatePlayerPos() {
        const cell = document.getElementById('cell-' + currentPos);
        const player = document.getElementById('player');
        player.style.left = cell.offsetLeft + (cell.offsetWidth/2 - 17.5) + 'px';
        player.style.top = cell.offsetTop + (cell.offsetHeight/2 - 17.5) + 'px';
    }

    function rollDice() {
        if (navigator.vibrate) navigator.vibrate(50);
        let step = Math.floor(Math.random() * 6) + 1;
        document.getElementById('msg').innerText = `æ“²å‡ºäº† ${step} é»ï¼`;
        
        let target = currentPos + step;
        if (target >= boardSize) {
            laps++;
            document.getElementById('lap-count').innerText = laps;
        }
        currentPos = target % boardSize;
        updatePlayerPos();

        if (foodCells[currentPos]) {
            foodCollected.add(foodCells[currentPos]);
            document.getElementById('food-count').innerText = foodCollected.size;
        }

        if (foodCollected.size >= 4 || laps > 5) {
            setTimeout(showResult, 600);
        }
    }

    function showResult() {
        document.getElementById('overlay').classList.remove('hidden');
        document.getElementById('modal-content').innerHTML = `
            <div class="ticket">
                <h3>ğŸ« è±ç”ŸèŒ¶é¤¨ å…¥åº§è­‰</h3>
                <p>æ™‚é–“ï¼š3/8 (æ—¥) 12:00</p>
                <div class="glass-heart">
                    å§æ‹‰æ‹‰ï¼šç‚ºäº†é˜²æ­¢æœ‰äººæ”¾é´¿å­ï¼Œè«‹ä¾äººæ•¸ç¹³ç´è¨‚é‡‘ã€‚ä¸ç„¶ä¸»è¾¦æ–¹æœƒç»ç’ƒå¿ƒç¢æ‰ï¼Œç¢åˆ°æ˜å¤©éƒ½ä¸èƒ½ä¸Šç­äº†...ğŸ’”
                </div>
                <p>ğŸ’° è¨‚é‡‘ï¼š$100 / äºº (2/25 æ­¢)</p>
                <button class="btn" id="share-btn">å›å ±æˆ°ç¸¾ä¸¦åˆ†äº«</button>
                <br><br>
                <button style="background:none; border:none; color:blue; text-decoration:underline; cursor:pointer;" onclick="window.open('https://www.google.com/maps/search/?api=1&query=è±ç”ŸèŒ¶é¤¨')">ğŸ“ é–‹å•Ÿå°èˆª</button>
            </div>
        `;
        document.getElementById('share-btn').onclick = share;
    }

    function share() {
        if (liff.isApiAvailable('shareTargetPicker')) {
            liff.shareTargetPicker([{
                "type": "text",
                "text": "æˆ‘å·²é ˜å– 3/8 è±ç”ŸèŒ¶é¤¨å…¥åº§è­‰ï¼æˆ‘æœƒä¿è­·ä¸»è¾¦æ–¹çš„ç»ç’ƒå¿ƒï¼Œåœ¨ 2/25 å‰äº¤å¥½è¨‚é‡‘ï¼ğŸ’”ğŸ’ª"
            }]).then(() => liff.closeWindow());
        } else {
            alert("è«‹åœ¨ LINE App ä¸­é–‹å•Ÿä»¥åˆ†äº«è¨Šæ¯ï¼");
        }
    }
</script>
</body>
</html>
