<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è±ç”ŸèŒ¶é¤¨ï¼šåƒè²¨å ±åæŒ‘æˆ°</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        :root { --main-color: #8B4513; --bg-color: #FDF5E6; }
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: var(--bg-color); margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; overflow-x: hidden; }
        #game-container { width: 100%; max-width: 400px; padding: 20px; text-align: center; box-sizing: border-box; }
        .board { display: grid; grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(4, 1fr); gap: 8px; margin: 20px 0; background: #D2B48C; padding: 10px; border-radius: 15px; position: relative; box-shadow: inset 0 0 10px rgba(0,0,0,0.2); }
        .cell { aspect-ratio: 1; background: #FFF; border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 18px; position: relative; border-bottom: 4px solid #ccc; }
        .cell.event { background: #FFECB3; font-weight: bold; }
        .center { grid-column: 2 / 4; grid-row: 2 / 4; background: #FFDAB9; font-weight: bold; font-size: 14px; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 10px; border: 2px solid #E67E22; }
        #player { width: 40px; height: 40px; border-radius: 50%; position: absolute; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 10; border: 3px solid white; box-shadow: 0 4px 8px rgba(0,0,0,0.3); object-fit: cover; left: 0; top: 0; }
        .btn { background: #E67E22; color: white; border: none; padding: 15px 35px; border-radius: 30px; font-size: 20px; font-weight: bold; cursor: pointer; box-shadow: 0 5px #D35400; transition: 0.1s; }
        .btn:active { transform: translateY(3px); box-shadow: 0 2px #D35400; }
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 100; display: flex; align-items: center; justify-content: center; }
        .modal { background: white; padding: 30px; border-radius: 25px; width: 85%; max-width: 320px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .ticket { border: 3px dashed #8B4513; padding: 20px; background: #FFF9E3; border-radius: 10px; }
        .glass-heart { color: #e74c3c; font-size: 15px; font-weight: bold; margin: 15px 0; line-height: 1.6; background: #ffeaea; padding: 10px; border-radius: 10px; }
        .hidden { display: none !important; }
        .shake { animation: shake 0.5s; }
        @keyframes shake { 0% { transform: translate(1px, 1px) rotate(0deg); } 10% { transform: translate(-1px, -2px) rotate(-1deg); } 20% { transform: translate(-3px, 0px) rotate(1deg); } 30% { transform: translate(3px, 2px) rotate(0deg); } 40% { transform: translate(1px, -1px) rotate(1deg); } 50% { transform: translate(-1px, 2px) rotate(-1deg); } }
    </style>
</head>
<body>

<div id="game-container">
    <h2 style="color: #8B4513; margin-bottom: 5px;">ğŸ± åƒè²¨å¤§å¯Œç¿</h2>
    <div id="stat" style="margin-bottom: 10px;">
        <span style="background: #fff; padding: 5px 10px; border-radius: 15px; border: 1px solid #ddd;">ğŸ± <span id="food-count">0</span> / 4</span>
        <span style="background: #fff; padding: 5px 10px; border-radius: 15px; border: 1px solid #ddd;">ğŸš© ç¬¬ <span id="lap-count">1</span> åœˆ</span>
    </div>
    
    <div class="board" id="board">
        <img id="player" src="https://cdn-icons-png.flaticon.com/512/147/147144.png" alt="player">
        <div class="center">è±ç”ŸèŒ¶é¤¨<br><span style="font-size: 10px;">3/8 12:00</span></div>
    </div>

    <button class="btn" id="dice-btn">ğŸ² æ“²éª°å­</button>
    <div id="msg" style="margin-top:20px; height: 3em; color: #8B4513; font-weight: bold; font-size: 15px; padding: 0 10px;">å§æ‹‰æ‹‰ï¼šå¿«æ“²éª°å­é–‹å§‹å†’éšªå§ï¼</div>
</div>

<div id="overlay">
    <div class="modal" id="modal-content">
        <h3 style="color: #E67E22;">ğŸ“£ å§æ‹‰æ‹‰å°æ’­å…¬å‘Š</h3>
        <p>3/8 12:00 è±ç”ŸèŒ¶é¤¨èšé¤ä»»å‹™ï¼<br>è«‹åœ¨ 5 åœˆå…§é›†é½Š 4 æ¨£å¿…åƒç¾é£Ÿæ‰ç®—å ±åæˆåŠŸå–”ï¼</p>
        <p style="color:red; font-weight:bold;">âš ï¸ éœ€ç¹³ç´ $100 è¨‚é‡‘</p>
        <button class="btn" id="start-btn">äº†è§£ï¼Œé–‹ç©ï¼</button>
    </div>
</div>

<script>
    const liffId = "2009192757-ZZX0pw1b";
    let currentPos = 0;
    let foodCollected = new Set();
    let laps = 1;
    const boardSize = 12;
    
    // å®šç¾©æ ¼å­å…§å®¹
    const boardConfig = [
        { icon: "ğŸ ", name: "èµ·é»" }, { icon: "â“", name: "å‘½é‹", type: "event" }, { icon: "ğŸ±", name: "é£½åˆ°å¤©éˆè“‹è±ªè¯ä¾¿ç•¶" },
        { icon: "â“", name: "æ©Ÿæœƒ", type: "event" }, { icon: "ğŸƒ", name: "å¿«èµ°" }, { icon: "ğŸ§‹", name: "ä¸»è¾¦æ–¹æ·šæ°´çå¥¶" },
        { icon: "ğŸš§", name: "å¡è»Š", type: "event" }, { icon: "â“", name: "å‘½é‹", type: "event" }, { icon: "ğŸ¥Ÿ", name: "çš®è–„å¿ƒè»Ÿå™´æ±é¤ƒ" },
        { icon: "ğŸ§§", name: "æ©Ÿæœƒ", type: "event" }, { icon: "ğŸƒ", name: "è¡åˆº" }, { icon: "ğŸ—", name: "ä¸»è¾¦æ–¹ç¢ç¢å¿µç‚¸é›" }
    ];

    window.onload = function() {
        const boardNode = document.getElementById('board');
        boardConfig.forEach((config, i) => {
            let div = document.createElement('div');
            div.className = config.type === "event" ? 'cell event' : 'cell';
            div.id = 'cell-' + i;
            div.innerHTML = `<span style="font-size:20px">${config.icon}</span><span style="font-size:10px">${config.name}</span>`;
            boardNode.appendChild(div);
        });
        
        document.getElementById('start-btn').onclick = () => document.getElementById('overlay').classList.add('hidden');
        document.getElementById('dice-btn').onclick = rollDice;

        liff.init({ liffId }).then(() => {
            if (!liff.isLoggedIn()) liff.login();
            liff.getProfile().then(p => { document.getElementById('player').src = p.pictureUrl; });
        });
        setTimeout(updatePlayerPos, 500);
    };

    function updatePlayerPos() {
        const cell = document.getElementById('cell-' + currentPos);
        const player = document.getElementById('player');
        player.style.left = cell.offsetLeft + (cell.offsetWidth/2 - 20) + 'px';
        player.style.top = cell.offsetTop + (cell.offsetHeight/2 - 20) + 'px';
    }

    function rollDice() {
        if (navigator.vibrate) navigator.vibrate(50);
        const dice = Math.floor(Math.random() * 6) + 1;
        document.getElementById('msg').innerText = `ğŸ² ä½ æ“²å‡ºäº† ${dice} é»ï¼`;
        movePlayer(dice);
    }

    function movePlayer(step) {
        let target = currentPos + step;
        if (target >= boardSize) {
            laps++;
            document.getElementById('lap-count').innerText = laps;
            say("å§æ‹‰æ‹‰ï¼šå“‡ï¼åˆç¹ä¸€åœˆäº†ï¼Œé›¢ç¾é£Ÿæ›´è¿‘äº†ï¼");
        }
        currentPos = target % boardSize;
        updatePlayerPos();

        setTimeout(() => {
            const cell = boardConfig[currentPos];
            if (["ğŸ±", "ğŸ§‹", "ğŸ¥Ÿ", "ğŸ—"].includes(cell.icon)) {
                if (!foodCollected.has(cell.icon)) {
                    foodCollected.add(cell.icon);
                    document.getElementById('food-count').innerText = foodCollected.size;
                    say(`å§æ‹‰æ‹‰ï¼šå¤ªæ£’äº†ï¼ç²å¾—äº† ${cell.icon}ï¼`);
                } else {
                    say(`å§æ‹‰æ‹‰ï¼šé€™é“ ${cell.icon} ä½ å·²ç¶“æ‹¿éå›‰ï½`);
                }
            } else if (cell.type === "event") {
                triggerEvent();
            }

            if (foodCollected.size >= 4 || laps > 5) {
                setTimeout(showResult, 1000);
            }
        }, 500);
    }

    function triggerEvent() {
        const events = [
            { m: "å§æ‹‰æ‹‰æ‡‰æ´ï¼å‰é€² 1 æ ¼", s: 1 },
            { m: "æ¢…å·æ±è·¯å¤§å¡è»Šï¼é€€å¾Œ 1 æ ¼", s: -1 },
            { m: "æ‰‹æ©Ÿå¤§åœ°éœ‡ï¼(ç•«é¢åŠ‡çƒˆæŠ–å‹•)", s: 0, v: true },
            { m: "å§æ‹‰æ‹‰ç¢ç¢å¿µï¼šè¨˜å¾— 2/25 å‰äº¤è¨‚é‡‘å–”ï¼", s: 0 }
        ];
        const e = events[Math.floor(Math.random() * events.length)];
        say(e.m);
        if (e.v) {
            document.body.classList.add('shake');
            if (navigator.vibrate) navigator.vibrate(400);
            setTimeout(() => document.body.classList.remove('shake'), 500);
        }
        if (e.s !== 0) {
            setTimeout(() => {
                currentPos = (currentPos + e.s + boardSize) % boardSize;
                updatePlayerPos();
            }, 800);
        }
    }

    function say(txt) { document.getElementById('msg').innerText = txt; }

    function showResult() {
        document.getElementById('overlay').classList.remove('hidden');
        document.getElementById('modal-content').innerHTML = `
            <div class="ticket">
                <h3 style="margin-top:0;">ğŸ« è±ç”ŸèŒ¶é¤¨ å…¥åº§æ†‘è­‰</h3>
                <p>æ™‚é–“ï¼š3/8 (æ—¥) 12:00</p>
                <div class="glass-heart">
                    ç‚ºäº†é˜²æ­¢æœ‰äººæ”¾é´¿å­ï¼Œè«‹ä¾äººæ•¸ç¹³ç´è¨‚é‡‘ã€‚ä¸ç„¶ä¸»è¾¦æ–¹æœƒç»ç’ƒå¿ƒç¢æ‰ï¼Œæ˜å¤©éƒ½ä¸èƒ½ä¸Šç­äº†...ğŸ’”
                </div>
                <p style="font-weight:bold; color:#D35400;">ğŸ’° è¨‚é‡‘ï¼š$100 / äºº<br><span style="font-size:12px">(2/25 æˆªæ­¢ï¼Œç¾å ´å¯æŠµæ¶ˆè²»)</span></p>
                <button class="btn" id="share-btn" style="font-size:16px;">å›å ±æˆ°ç¸¾ä¸¦åˆ†äº«</button>
                <br><br>
                <a href="http://googleusercontent.com/maps.google.com/3" target="_blank" style="color:#8B4513; font-size:14px;">ğŸ“ é–‹å•Ÿ Google Maps å°èˆª</a>
            </div>
        `;
        document.getElementById('share-btn').onclick = share;
    }

    function share() {
        if (!liff.isApiAvailable('shareTargetPicker')) return alert("è«‹åœ¨ LINE ä¸­é–‹å•Ÿï¼");
        liff.shareTargetPicker([{
            "type": "text",
            "text": `æˆ‘å·²é ˜å– 3/8 è±ç”ŸèŒ¶é¤¨å…¥åº§è­‰ï¼æˆ‘æ”¶é›†äº† ${foodCollected.size} ç¨®ç¾é£Ÿï¼Œæˆ‘æœƒä¿è­·ä¸»è¾¦æ–¹çš„ç»ç’ƒå¿ƒï¼Œåœ¨ 2/25 å‰äº¤å¥½è¨‚é‡‘ï¼ğŸ’”ğŸ’ª`
        }]).then(() => liff.closeWindow());
    }
</script>
</body>
</html>
