<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è±ç”ŸèŒ¶é¤¨ï¼šè·‘æ­¥é€²å ´é‚€è«‹å‡½</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        :root { --main-color: #8B4513; --bg-color: #FDF5E6; --accent: #E67E22; --card-bg: #FFF9E3; }
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: var(--bg-color); margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; overflow: hidden; touch-action: manipulation; }
        
        #game-container { width: 100%; max-width: 400px; padding: 15px; text-align: center; box-sizing: border-box; }
        
        /* å§æ‹‰æ‹‰å…¬å‘Šå¡ç‰‡æ¨£å¼ */
        .announcement-card { background: white; border: 3px solid var(--accent); border-radius: 15px; padding: 15px; margin-bottom: 15px; position: relative; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .announcement-header { background: var(--accent); color: white; padding: 5px 15px; border-radius: 20px; font-size: 14px; font-weight: bold; display: inline-block; position: absolute; top: -12px; left: 50%; transform: translateX(-50%); white-space: nowrap; }
        .announcement-content { margin-top: 5px; font-size: 14px; color: #5D4037; line-height: 1.5; }
        .announcement-footer { font-size: 12px; color: #E74C3C; font-weight: bold; margin-top: 5px; border-top: 1px dashed #D2B48C; padding-top: 5px; }

        /* æ”¶é›†å€åŸŸ */
        #collection-zone { display: flex; justify-content: center; align-items: center; gap: 12px; margin-bottom: 10px; background: #fff; padding: 10px; border-radius: 20px; border: 2px solid #D2B48C; }
        .food-slot { font-size: 26px; filter: grayscale(100%); opacity: 0.2; transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .food-slot.active { filter: grayscale(0%); opacity: 1; transform: scale(1.3) rotate(10deg); }

        /* æ£‹ç›¤æ ¼ */
        .board { display: grid; grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(4, 1fr); gap: 8px; margin: 15px 0; background: #D2B48C; padding: 10px; border-radius: 18px; position: relative; }
        .cell { aspect-ratio: 1; background: #FFF; border-radius: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 13px; position: relative; border-bottom: 4px solid #ddd; }
        .cell.event { background: #FFF9C4; color: #D35400; font-weight: bold; }
        
        .center { grid-column: 2 / 4; grid-row: 2 / 4; background: #FFDAB9; font-weight: bold; font-size: 14px; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 15px; border: 2px dashed #E67E22; color: #8B4513; }
        
        #player { width: 42px; height: 42px; border-radius: 50%; position: absolute; transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55); z-index: 10; border: 3px solid white; box-shadow: 0 6px 12px rgba(0,0,0,0.3); object-fit: cover; }
        
        .btn { background: var(--accent); color: white; border: none; padding: 14px 0; border-radius: 35px; font-size: 18px; font-weight: bold; cursor: pointer; box-shadow: 0 5px #D35400; width: 85%; }
        .btn:disabled { background: #BDC3C7; box-shadow: none; cursor: not-allowed; }
        
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 100; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(3px); }
        .modal { background: white; padding: 30px 20px; border-radius: 25px; width: 85%; max-width: 320px; text-align: center; border: 5px solid var(--accent); position: relative; }
        .hidden { display: none !important; }
        .shake { animation: shakeEffect 0.5s; }
        @keyframes shakeEffect { 0%, 100% { transform: translateX(0); } 20% { transform: translateX(-10px); } 40% { transform: translateX(10px); } 60% { transform: translateX(-10px); } 80% { transform: translateX(10px); } }
    </style>
</head>
<body>

<div id="game-container">
    <div class="announcement-card">
        <div class="announcement-header">ğŸ“¢ å§æ‹‰æ‹‰å°æ’­å…¬å‘Š</div>
        <div class="announcement-content">
            <b>è±ç”ŸèŒ¶é¤¨åƒè²¨ä»»å‹™</b><br>
            æ”¶é›† 4 æ¨£ç¾é£Ÿæˆ–ç¹å®Œ 5 åœˆå³å¯ç²å¾—å…¥åº§è­‰ï¼<br>
            ğŸ“… 3/8 (æ—¥) 12:00 è·‘æ­¥é€²å ´
        </div>
        <div class="announcement-footer">âš ï¸ éœ€äº¤ $100 è¨‚é‡‘æ–¹å¯å ±åæˆåŠŸ</div>
    </div>
    
    <div id="collection-zone">
        <div id="slot-ğŸ±" class="food-slot">ğŸ±</div>
        <div id="slot-ğŸ§‹" class="food-slot">ğŸ§‹</div>
        <div id="slot-ğŸ¥Ÿ" class="food-slot">ğŸ¥Ÿ</div>
        <div id="slot-ğŸ—" class="food-slot">ğŸ—</div>
        <div style="margin-left: 10px; font-weight: bold; color: #8B4513;">ğŸš© <span id="lap-count">1</span>/5</div>
    </div>
    
    <div class="board" id="board">
        <img id="player" src="https://cdn-icons-png.flaticon.com/512/147/147144.png" alt="player">
        <div class="center">è±ç”ŸèŒ¶é¤¨<br><span style="font-size: 11px;">è·‘æ­¥é€²å ´</span></div>
    </div>

    <button class="btn" id="dice-btn">ğŸ² æ“²éª°å­å‡ºç™¼</button>
    <div id="msg" style="margin-top:15px; color: #8B4513; font-weight: bold;">å§æ‹‰æ‹‰ï¼šçœ‹èª°å…ˆæ”¶é›†å®Œï¼</div>
</div>

<div id="overlay" class="hidden">
    <div class="modal" id="modal-content"></div>
</div>

<script>
    const liffId = "2009192757-ZZX0pw1b";
    let currentPos = 0, foodCollected = new Set(), laps = 1, isMoving = false, boardSize = 12;
    
    const boardConfig = [
        { icon: "ğŸ ", name: "èµ·é»", msg: "å›åˆ°èµ·é»ï¼å§æ‹‰æ‹‰ï¼šé«”åŠ›è£œæ»¿ï¼" }, 
        { icon: "â“", name: "å‘½é‹", type: "event" }, 
        { icon: "ğŸ±", name: "é£½åˆ°å¤©éˆè“‹<br>è±ªè¯ä¾¿ç•¶", msg: "å§æ‹‰æ‹‰ï¼šé€™ä¾¿ç•¶ä»½é‡å¤ªç‹‚äº†å§ï¼ğŸ±" },
        { icon: "â“", name: "æ©Ÿæœƒ", type: "event" }, 
        { icon: "ğŸƒ", name: "å¿«æ­¥", msg: "å§æ‹‰æ‹‰ï¼šè·‘å¿«é»ï¼Œç¾é£Ÿä¸ç­‰äººï¼" }, 
        { icon: "ğŸ§‹", name: "ä¸»è¾¦æ–¹<br>æ·šæ°´çå¥¶", msg: "å§æ‹‰æ‹‰ï¼šé€™çç è£¡æœ‰ä¸»è¾¦æ–¹æ„Ÿå‹•çš„æ·šæ°´ã€‚ğŸ’”" },
        { icon: "ğŸš§", name: "å¡è»Š", type: "event" }, 
        { icon: "â“", name: "å‘½é‹", type: "event" }, 
        { icon: "ğŸ¥Ÿ", name: "çš®è–„å¿ƒè»Ÿ<br>å™´æ±é¤ƒ", msg: "å§æ‹‰æ‹‰ï¼šå°å¿ƒå™´æ±ï¼é€™å£æ„Ÿçµ•äº†ã€‚ğŸ’¸" },
        { icon: "ğŸ§§", name: "æ©Ÿæœƒ", type: "event" }, 
        { icon: "ğŸƒ", name: "è¡åˆº", msg: "å§æ‹‰æ‹‰ï¼šç‚ºäº†å¤§é¤ï¼Œè¡åˆºå§ï¼" }, 
        { icon: "ğŸ—", name: "ä¸»è¾¦æ–¹<br>ç¢ç¢å¿µç‚¸é›", msg: "å§æ‹‰æ‹‰ï¼šè½è‘—ä¸»è¾¦æ–¹çš„ç¢ç¢å¿µï¼Œç‚¸é›æ›´é¦™äº†ã€‚ğŸ—" }
    ];

    window.onload = function() {
        const boardNode = document.getElementById('board');
        boardConfig.forEach((config, i) => {
            let div = document.createElement('div');
            div.className = config.type === "event" ? 'cell event' : 'cell';
            div.id = 'cell-' + i;
            div.innerHTML = `<span style="font-size:20px">${config.icon}</span><span style="font-size:10px">${config.name}</span>`;
            boardNode.appendChild(div);
        });
        document.getElementById('dice-btn').onclick = rollDice;
        liff.init({ liffId }).then(() => {
            if (!liff.isLoggedIn()) liff.login();
            liff.getProfile().then(p => { document.getElementById('player').src = p.pictureUrl; });
        });
        setTimeout(updatePlayerPos, 500);
    };

    function popModal(html) {
        document.getElementById('modal-content').innerHTML = html;
        document.getElementById('overlay').classList.remove('hidden');
    }
    function closeModal() { document.getElementById('overlay').classList.add('hidden'); }

    function updatePlayerPos() {
        const cell = document.getElementById('cell-' + currentPos);
        const player = document.getElementById('player');
        player.style.left = cell.offsetLeft + (cell.offsetWidth/2 - 21) + 'px';
        player.style.top = cell.offsetTop + (cell.offsetHeight/2 - 21) + 'px';
    }

    async function rollDice() {
        if (isMoving) return;
        isMoving = true;
        document.getElementById('dice-btn').disabled = true;
        const dice = Math.floor(Math.random() * 6) + 1;
        document.getElementById('msg').innerText = `ğŸ² æ“²å‡ºäº† ${dice} é»ï¼`;
        
        for (let i = 0; i < dice; i++) {
            await new Promise(r => setTimeout(r, 350));
            currentPos = (currentPos + 1) % boardSize;
            if (currentPos === 0) { laps++; document.getElementById('lap-count').innerText = laps; }
            updatePlayerPos();
        }
        setTimeout(() => { handleLanding(); isMoving = false; document.getElementById('dice-btn').disabled = false; }, 400);
    }

    function handleLanding() {
        const cell = boardConfig[currentPos];
        const foodIcons = ["ğŸ±", "ğŸ§‹", "ğŸ¥Ÿ", "ğŸ—"];
        if (foodIcons.includes(cell.icon)) {
            if (!foodCollected.has(cell.icon)) {
                foodCollected.add(cell.icon);
                document.getElementById(`slot-${cell.icon}`).classList.add('active');
            }
            popModal(`<h3>ğŸ˜‹ è¸©åˆ°ç¾é£Ÿï¼</h3><h1 style="font-size:55px; margin:15px 0;">${cell.icon}</h1><p><b>${cell.name.replace('<br>','')}</b></p><p>${cell.msg}</p><button class="btn" onclick="checkEnd()">æ”¶é€²å£è¢‹</button>`);
        } 
        else if (cell.type === "event") { triggerEvent(); }
        else { popModal(`<h3>ğŸ“ åˆ°é” ${cell.name}</h3><p>${cell.msg}</p><button class="btn" onclick="checkEnd()">çŸ¥é“äº†</button>`); }
    }

    function triggerEvent() {
        const events = [
            { t: "å§æ‹‰æ‹‰åŠ©é™£ï¼", m: "å§æ‹‰æ‹‰åœ¨èƒŒå¾Œæ¨äº†ä½ ä¸€æŠŠï¼Œå‰é€² 1 æ ¼ï¼", s: 1 },
            { t: "è·¯é‚Šæ»‘å€’ï¼", m: "åœ°æ¿å¤ªæ²¹äº†ï¼Œç‹¼ç‹½åœ°å‘å¾Œé€€ 1 æ ¼...", s: -1 },
            { t: "å§æ‹‰æ‹‰æ¨æ‹¿æ™‚é–“", m: "ä½ èµ°å¾—å¤ªè¾›è‹¦äº†ï¼Œå¼·åˆ¶ä¼‘æ¯ 5 ç§’æ”¾é¬†ä¸€ä¸‹...", s: 0, wait: 5 },
            { t: "ç¢ç¢å¿µæ”»æ“Šï¼", m: "å§æ‹‰æ‹‰ï¼šè¨˜å¾—äº¤è¨‚é‡‘å–”ï¼Œä¸äº¤æˆ‘å°±å»ä½ å®¶é–€å£å“­ï¼ğŸ’”", s: 0 }
        ];
        const e = events[Math.floor(Math.random() * events.length)];
        if (e.wait) { startWait(e.t, e.m, e.wait); } 
        else { popModal(`<h3>${e.t}</h3><p>${e.m}</p><button class="btn" onclick="executeEvent(${e.s})">æ”¶åˆ°</button>`); }
    }

    function startWait(title, msg, seconds) {
        let timeLeft = seconds;
        isMoving = true;
        document.getElementById('dice-btn').disabled = true;
        const updateWaitModal = () => {
            popModal(`<h3>${title}</h3><p>${msg}</p><h2 id="timer" style="color:#E67E22; font-size:45px; margin:15px 0;">${timeLeft}</h2><p>å€’æ•¸çµæŸæ‰èƒ½èµ°ï¼</p>`);
            if (timeLeft > 0) { timeLeft--; setTimeout(updateWaitModal, 1000); } 
            else { popModal(`<h3>ä¼‘æ¯çµæŸï¼</h3><p>å§æ‹‰æ‹‰ï¼šç¹¼çºŒå‰é€²ï¼</p><button class="btn" onclick="isMoving=false; document.getElementById('dice-btn').disabled=false; checkEnd();">å‡ºç™¼ï¼</button>`); }
        };
        updateWaitModal();
    }

    async function executeEvent(s) {
        closeModal();
        if (s !== 0) {
            await new Promise(r => setTimeout(r, 450));
            currentPos = (currentPos + s + boardSize) % boardSize;
            updatePlayerPos();
            setTimeout(handleLanding, 450);
        } else { checkEnd(); }
    }

    function checkEnd() {
        closeModal();
        if (foodCollected.size >= 4 || laps > 5) { setTimeout(showResult, 600); }
    }

    function showResult() {
        popModal(`<div style="border: 2px dashed #8B4513; padding: 15px; background: #FFF9E3;"><h3>ğŸ« è±ç”ŸèŒ¶é¤¨ å…¥åº§æ†‘è­‰</h3><p>æ™‚é–“ï¼š3/8 (æ—¥) 12:00</p><p style="color: #e74c3c; font-size: 13px; font-weight: bold;">å§æ‹‰æ‹‰ï¼šæ‹œè¨—ä¸€å®šè¦ä¾†ï¼Œä¸ç„¶æˆ‘çš„ç»ç’ƒå¿ƒæœƒç¢...ğŸ’”</p><button class="btn" onclick="share()" style="margin-top:10px;">åˆ†äº«æˆ°ç¸¾ä¸¦çµæŸ</button></div>`);
    }

    function share() {
        const msgText = `æˆ‘å·²é ˜å– 3/8 è±ç”ŸèŒ¶é¤¨å…¥åº§è­‰ï¼æˆ‘æ”¶é›†äº† ${foodCollected.size} ç¨®ç¾é£Ÿï¼ğŸ’”ğŸ’ª`;
        liff.shareTargetPicker([{"type": "text", "text": msgText}]).then(() => liff.closeWindow());
    }
</script>
</body>
</html>
